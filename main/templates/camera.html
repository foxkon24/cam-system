<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, shrink-to-fit=no, user-scalable=no">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/hls/hls.js"></script>
    <title>監視カメラシステム - {{ camera.name }}</title>
</head>
<body>
    <div class="layout">
        <header><h1>監視カメラシステム</h1></header>
        <nav>
            <ul>
            </ul>
        </nav>
        <div class="container">
            <div class="grid">
                <div class="camera">
                    <h4>{{ camera.name }}</h4>
                    <video id="video" controls autoplay muted playsinline style="width: 640px; height: 480px;"></video>
                </div>
            </div>
        </div>
        <footer>&nbsp;&nbsp;Copyright&copy;&nbsp;&nbsp;2024&nbsp;&nbsp;株式会社&nbsp;共立電機製作所&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</footer>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var video = document.getElementById('video');
            var videoSrc = '/system/cam/tmp/{{ camera.id }}/{{ camera.id }}.m3u8';
            
            if (Hls.isSupported()) {
                var hls = new Hls();
                hls.loadSource(videoSrc);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.play();
                });
                hls.on(Hls.Events.ERROR, function(event, data) {
                    console.log('HLS Error:', data);
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                console.log('Network error, trying to recover...');
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                console.log('Media error, trying to recover...');
                                hls.recoverMediaError();
                                break;
                            default:
                                console.log('Unrecoverable error');
                                hls.destroy();
                                break;
                        }
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = videoSrc;
            }
        });
    </script>
</body>
</html>
